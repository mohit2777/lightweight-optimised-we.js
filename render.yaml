# Render Blueprint for WhatsApp Multi-Automation
# Deploy with: render blueprint deploy

services:
  - type: web
    name: wa-multi-automation
    runtime: docker
    dockerfilePath: ./Dockerfile.render
    dockerContext: .
    
    # Health check configuration
    healthCheckPath: /health
    
    # Environment variables
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "10000"
      - key: PUPPETEER_EXECUTABLE_PATH
        value: /usr/bin/google-chrome
      
      # Memory optimization
      - key: NODE_OPTIONS
        value: "--max-old-space-size=256"
      
      # Supabase (set these in Render dashboard)
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      
      # Security (generate secure values)
      - key: SESSION_SECRET
        generateValue: true
      - key: DASHBOARD_USERNAME
        sync: false
      - key: DASHBOARD_PASSWORD
        sync: false
      
      # Session cookies (enable for HTTPS)
      - key: SESSION_COOKIE_SECURE
        value: "true"
      
      # Database URL for session storage
      - key: DATABASE_URL
        sync: false
      
      # Session persistence (enabled)
      - key: DISABLE_PERIODIC_SESSION_SAVE
        value: "false"
      - key: SESSION_SAVE_INTERVAL_MS
        value: "900000"
      
      # Keepalive for free tier (prevents sleep)
      - key: KEEPALIVE_URL
        sync: false
      - key: KEEPALIVE_INTERVAL_MINUTES
        value: "14"
      
      # Webhook worker (reduce polling)
      - key: WEBHOOK_WORKER_INTERVAL_MS
        value: "30000"
    
    # Disk for persistent session storage (optional, paid feature)
    # disk:
    #   name: wa-sessions
    #   mountPath: /app/wa-sessions-temp
    #   sizeGB: 1
    
    # Auto-deploy on push
    autoDeploy: true
    
    # Scaling (for paid plans)
    # numInstances: 1
    
    # Plan (free tier has limitations)
    plan: free
    
    # Region
    region: oregon
